

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>tests.test_bukuDb &mdash; Buku  documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="Buku  documentation" href="../../index.html"/>
        <link rel="up" title="Module code" href="../index.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> Buku
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../source/buku.html">Buku</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Buku</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>tests.test_bukuDb</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for tests.test_bukuDb</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="c1">#</span>
<span class="c1"># Unit test cases for buku</span>
<span class="c1">#</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">sqlite3</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">genericpath</span> <span class="k">import</span> <span class="n">exists</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="k">import</span> <span class="n">product</span>
<span class="kn">from</span> <span class="nn">tempfile</span> <span class="k">import</span> <span class="n">TemporaryDirectory</span>

<span class="kn">from</span> <span class="nn">hypothesis</span> <span class="k">import</span> <span class="n">given</span><span class="p">,</span> <span class="n">example</span>
<span class="kn">from</span> <span class="nn">hypothesis</span> <span class="k">import</span> <span class="n">strategies</span> <span class="k">as</span> <span class="n">st</span>
<span class="kn">from</span> <span class="nn">unittest</span> <span class="k">import</span> <span class="n">mock</span> <span class="k">as</span> <span class="n">mock</span>
<span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">import</span> <span class="nn">unittest</span>

<span class="kn">from</span> <span class="nn">buku</span> <span class="k">import</span> <span class="n">BukuDb</span><span class="p">,</span> <span class="n">parse_tags</span><span class="p">,</span> <span class="n">prompt</span>

<span class="n">TEST_TEMP_DIR_OBJ</span> <span class="o">=</span> <span class="n">TemporaryDirectory</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;bukutest_&#39;</span><span class="p">)</span>
<span class="n">TEST_TEMP_DIR_PATH</span> <span class="o">=</span> <span class="n">TEST_TEMP_DIR_OBJ</span><span class="o">.</span><span class="n">name</span>
<span class="n">TEST_TEMP_DBDIR_PATH</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">TEST_TEMP_DIR_PATH</span><span class="p">,</span> <span class="s1">&#39;buku&#39;</span><span class="p">)</span>
<span class="n">TEST_TEMP_DBFILE_PATH</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">TEST_TEMP_DBDIR_PATH</span><span class="p">,</span> <span class="s1">&#39;bookmarks.db&#39;</span><span class="p">)</span>
<span class="n">MAX_SQLITE_INT</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">63</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">TEST_BOOKMARKS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="s1">&#39;http://slashdot.org&#39;</span><span class="p">,</span>
     <span class="s1">&#39;SLASHDOT&#39;</span><span class="p">,</span>
     <span class="n">parse_tags</span><span class="p">([</span><span class="s1">&#39;old,news&#39;</span><span class="p">]),</span>
     <span class="s2">&quot;News for old nerds, stuff that doesn&#39;t matter&quot;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;http://www.zażółćgęśląjaźń.pl/&#39;</span><span class="p">,</span>
     <span class="s1">&#39;ZAŻÓŁĆ&#39;</span><span class="p">,</span>
     <span class="n">parse_tags</span><span class="p">([</span><span class="s1">&#39;zażółć,gęślą,jaźń&#39;</span><span class="p">]),</span>
     <span class="s2">&quot;Testing UTF-8, zażółć gęślą jaźń.&quot;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;https://test.com:8080&#39;</span><span class="p">,</span>
     <span class="s1">&#39;test&#39;</span><span class="p">,</span>
     <span class="n">parse_tags</span><span class="p">([</span><span class="s1">&#39;test,tes,est,es&#39;</span><span class="p">]),</span>
     <span class="s2">&quot;a case for replace_tag test&quot;</span><span class="p">],</span>
<span class="p">]</span>

<span class="n">only_python_3_5</span> <span class="o">=</span> <span class="n">pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">skipif</span><span class="p">(</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">reason</span><span class="o">=</span><span class="s2">&quot;requires Python 3.5 or later&quot;</span><span class="p">)</span>


<div class="viewcode-block" id="setup"><a class="viewcode-back" href="../../source/tests.html#tests.test_bukuDb.setup">[docs]</a><span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">setup</span><span class="p">():</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;XDG_DATA_HOME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">TEST_TEMP_DIR_PATH</span>

    <span class="c1"># start every test from a clean state</span>
    <span class="k">if</span> <span class="n">exists</span><span class="p">(</span><span class="n">TEST_TEMP_DBFILE_PATH</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">TEST_TEMP_DBFILE_PATH</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestBukuDb"><a class="viewcode-back" href="../../source/tests.html#tests.test_bukuDb.TestBukuDb">[docs]</a><span class="k">class</span> <span class="nc">TestBukuDb</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

<div class="viewcode-block" id="TestBukuDb.setUp"><a class="viewcode-back" href="../../source/tests.html#tests.test_bukuDb.TestBukuDb.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;XDG_DATA_HOME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">TEST_TEMP_DIR_PATH</span>

        <span class="c1"># start every test from a clean state</span>
        <span class="k">if</span> <span class="n">exists</span><span class="p">(</span><span class="n">TEST_TEMP_DBFILE_PATH</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">TEST_TEMP_DBFILE_PATH</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">bookmarks</span> <span class="o">=</span> <span class="n">TEST_BOOKMARKS</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bdb</span> <span class="o">=</span> <span class="n">BukuDb</span><span class="p">()</span></div>

<div class="viewcode-block" id="TestBukuDb.tearDown"><a class="viewcode-back" href="../../source/tests.html#tests.test_bukuDb.TestBukuDb.tearDown">[docs]</a>    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;XDG_DATA_HOME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">TEST_TEMP_DIR_PATH</span></div>

    <span class="c1"># @unittest.skip(&#39;skipping&#39;)</span>
<div class="viewcode-block" id="TestBukuDb.test_get_default_dbdir"><a class="viewcode-back" href="../../source/tests.html#tests.test_bukuDb.TestBukuDb.test_get_default_dbdir">[docs]</a>    <span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">non_tox</span>
    <span class="k">def</span> <span class="nf">test_get_default_dbdir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">dbdir_expected</span> <span class="o">=</span> <span class="n">TEST_TEMP_DBDIR_PATH</span>
        <span class="n">dbdir_local_expected</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s1">&#39;~&#39;</span><span class="p">),</span> <span class="s1">&#39;.local&#39;</span><span class="p">,</span> <span class="s1">&#39;share&#39;</span><span class="p">,</span> <span class="s1">&#39;buku&#39;</span><span class="p">)</span>
        <span class="n">dbdir_relative_expected</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>

        <span class="c1"># desktop linux</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">dbdir_expected</span><span class="p">,</span> <span class="n">BukuDb</span><span class="o">.</span><span class="n">get_default_dbdir</span><span class="p">())</span>

        <span class="c1"># desktop generic</span>
        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;XDG_DATA_HOME&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">dbdir_local_expected</span><span class="p">,</span> <span class="n">BukuDb</span><span class="o">.</span><span class="n">get_default_dbdir</span><span class="p">())</span>

        <span class="c1"># no desktop</span>

        <span class="c1"># -- home is defined differently on various platforms.</span>
        <span class="c1"># -- keep a copy and set it back once done</span>
        <span class="n">originals</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">env_var</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;HOME&#39;</span><span class="p">,</span> <span class="s1">&#39;HOMEPATH&#39;</span><span class="p">,</span> <span class="s1">&#39;HOMEDIR&#39;</span><span class="p">]:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">originals</span><span class="p">[</span><span class="n">env_var</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">env_var</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">dbdir_relative_expected</span><span class="p">,</span> <span class="n">BukuDb</span><span class="o">.</span><span class="n">get_default_dbdir</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">originals</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span></div>

    <span class="c1"># # not sure how to test this in nondestructive manner</span>
    <span class="c1"># def test_move_legacy_dbfile(self):</span>
    <span class="c1">#     self.fail()</span>

    <span class="c1"># @unittest.skip(&#39;skipping&#39;)</span>
<div class="viewcode-block" id="TestBukuDb.test_initdb"><a class="viewcode-back" href="../../source/tests.html#tests.test_bukuDb.TestBukuDb.test_initdb">[docs]</a>    <span class="k">def</span> <span class="nf">test_initdb</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">exists</span><span class="p">(</span><span class="n">TEST_TEMP_DBFILE_PATH</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">TEST_TEMP_DBFILE_PATH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">exists</span><span class="p">(</span><span class="n">TEST_TEMP_DBFILE_PATH</span><span class="p">))</span>
        <span class="n">conn</span><span class="p">,</span> <span class="n">curr</span> <span class="o">=</span> <span class="n">BukuDb</span><span class="o">.</span><span class="n">initdb</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Connection</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">curr</span><span class="p">,</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Cursor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">exists</span><span class="p">(</span><span class="n">TEST_TEMP_DBFILE_PATH</span><span class="p">))</span>
        <span class="n">curr</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

    <span class="c1"># @unittest.skip(&#39;skipping&#39;)</span>
<div class="viewcode-block" id="TestBukuDb.test_get_rec_by_id"><a class="viewcode-back" href="../../source/tests.html#tests.test_bukuDb.TestBukuDb.test_get_rec_by_id">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_rec_by_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">bookmark</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bookmarks</span><span class="p">:</span>
            <span class="c1"># adding bookmark from self.bookmarks</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="o">.</span><span class="n">add_rec</span><span class="p">(</span><span class="o">*</span><span class="n">bookmark</span><span class="p">)</span>

        <span class="c1"># the expected bookmark</span>
        <span class="n">expected</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;http://slashdot.org&#39;</span><span class="p">,</span> <span class="s1">&#39;SLASHDOT&#39;</span><span class="p">,</span> <span class="s1">&#39;,news,old,&#39;</span><span class="p">,</span>
                    <span class="s2">&quot;News for old nerds, stuff that doesn&#39;t matter&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">bookmark_from_db</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="o">.</span><span class="n">get_rec_by_id</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># asserting bookmark matches expected</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expected</span><span class="p">,</span> <span class="n">bookmark_from_db</span><span class="p">)</span>
        <span class="c1"># asserting None returned if index out of range</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="o">.</span><span class="n">get_rec_by_id</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bookmarks</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span></div>

    <span class="c1"># @unittest.skip(&#39;skipping&#39;)</span>
<div class="viewcode-block" id="TestBukuDb.test_get_rec_id"><a class="viewcode-back" href="../../source/tests.html#tests.test_bukuDb.TestBukuDb.test_get_rec_id">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_rec_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">bookmark</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bookmarks</span><span class="p">):</span>
            <span class="c1"># adding bookmark from self.bookmarks to database</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="o">.</span><span class="n">add_rec</span><span class="p">(</span><span class="o">*</span><span class="n">bookmark</span><span class="p">)</span>
            <span class="c1"># asserting index is in order</span>
            <span class="n">idx_from_db</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="o">.</span><span class="n">get_rec_id</span><span class="p">(</span><span class="n">bookmark</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">idx_from_db</span><span class="p">)</span>

        <span class="c1"># asserting -1 is returned for nonexistent url</span>
        <span class="n">idx_from_db</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="o">.</span><span class="n">get_rec_id</span><span class="p">(</span><span class="s2">&quot;http://nonexistent.url&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">idx_from_db</span><span class="p">)</span></div>

    <span class="c1"># @unittest.skip(&#39;skipping&#39;)</span>
<div class="viewcode-block" id="TestBukuDb.test_add_rec"><a class="viewcode-back" href="../../source/tests.html#tests.test_bukuDb.TestBukuDb.test_add_rec">[docs]</a>    <span class="k">def</span> <span class="nf">test_add_rec</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">bookmark</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bookmarks</span><span class="p">:</span>
            <span class="c1"># adding bookmark from self.bookmarks to database</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="o">.</span><span class="n">add_rec</span><span class="p">(</span><span class="o">*</span><span class="n">bookmark</span><span class="p">)</span>
            <span class="c1"># retrieving bookmark from database</span>
            <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="o">.</span><span class="n">get_rec_id</span><span class="p">(</span><span class="n">bookmark</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">from_db</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="o">.</span><span class="n">get_rec_by_id</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">from_db</span><span class="p">)</span>
            <span class="c1"># comparing data</span>
            <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">from_db</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">bookmark</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="o">*</span><span class="n">pair</span><span class="p">)</span></div>

        <span class="c1"># TODO: tags should be passed to the api as a sequence...</span>

    <span class="c1"># @unittest.skip(&#39;skipping&#39;)</span>
<div class="viewcode-block" id="TestBukuDb.test_update_rec"><a class="viewcode-back" href="../../source/tests.html#tests.test_bukuDb.TestBukuDb.test_update_rec">[docs]</a>    <span class="k">def</span> <span class="nf">test_update_rec</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">old_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bookmarks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">new_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bookmarks</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># adding bookmark and getting index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="o">.</span><span class="n">add_rec</span><span class="p">(</span><span class="o">*</span><span class="n">old_values</span><span class="p">)</span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="o">.</span><span class="n">get_rec_id</span><span class="p">(</span><span class="n">old_values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="c1"># updating with new values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="o">.</span><span class="n">update_rec</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="o">*</span><span class="n">new_values</span><span class="p">)</span>
        <span class="c1"># retrieving bookmark from database</span>
        <span class="n">from_db</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="o">.</span><span class="n">get_rec_by_id</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">from_db</span><span class="p">)</span>
        <span class="c1"># checking if values are updated</span>
        <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">from_db</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">new_values</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="o">*</span><span class="n">pair</span><span class="p">)</span></div>

    <span class="c1"># @unittest.skip(&#39;skipping&#39;)</span>
<div class="viewcode-block" id="TestBukuDb.test_append_tag_at_index"><a class="viewcode-back" href="../../source/tests.html#tests.test_bukuDb.TestBukuDb.test_append_tag_at_index">[docs]</a>    <span class="k">def</span> <span class="nf">test_append_tag_at_index</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">bookmark</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bookmarks</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="o">.</span><span class="n">add_rec</span><span class="p">(</span><span class="o">*</span><span class="n">bookmark</span><span class="p">)</span>

        <span class="c1"># tags to add</span>
        <span class="n">old_tags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="o">.</span><span class="n">get_rec_by_id</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">new_tags</span> <span class="o">=</span> <span class="s2">&quot;,foo,bar,baz&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="o">.</span><span class="n">append_tag_at_index</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_tags</span><span class="p">)</span>
        <span class="c1"># updated list of tags</span>
        <span class="n">from_db</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="o">.</span><span class="n">get_rec_by_id</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="mi">3</span><span class="p">]</span>

        <span class="c1"># checking if new tags were added to the bookmark</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">split_and_test_membership</span><span class="p">(</span><span class="n">new_tags</span><span class="p">,</span> <span class="n">from_db</span><span class="p">))</span>
        <span class="c1"># checking if old tags still exist</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">split_and_test_membership</span><span class="p">(</span><span class="n">old_tags</span><span class="p">,</span> <span class="n">from_db</span><span class="p">))</span></div>

    <span class="c1"># @unittest.skip(&#39;skipping&#39;)</span>
<div class="viewcode-block" id="TestBukuDb.test_append_tag_at_all_indices"><a class="viewcode-back" href="../../source/tests.html#tests.test_bukuDb.TestBukuDb.test_append_tag_at_all_indices">[docs]</a>    <span class="k">def</span> <span class="nf">test_append_tag_at_all_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">bookmark</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bookmarks</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="o">.</span><span class="n">add_rec</span><span class="p">(</span><span class="o">*</span><span class="n">bookmark</span><span class="p">)</span>

        <span class="c1"># tags to add</span>
        <span class="n">new_tags</span> <span class="o">=</span> <span class="s2">&quot;,foo,bar,baz&quot;</span>
        <span class="c1"># record of original tags for each bookmark</span>
        <span class="n">old_tagsets</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="o">.</span><span class="n">get_rec_by_id</span><span class="p">(</span><span class="n">i</span><span class="p">)[</span><span class="mi">3</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">inclusive_range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bookmarks</span><span class="p">))}</span>

        <span class="k">with</span> <span class="n">mock</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s1">&#39;builtins.input&#39;</span><span class="p">,</span> <span class="n">return_value</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="o">.</span><span class="n">append_tag_at_index</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">new_tags</span><span class="p">)</span>
            <span class="c1"># updated tags for each bookmark</span>
            <span class="n">from_db</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="o">.</span><span class="n">get_rec_by_id</span><span class="p">(</span><span class="n">i</span><span class="p">)[</span><span class="mi">3</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">inclusive_range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bookmarks</span><span class="p">))]</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">tagset</span> <span class="ow">in</span> <span class="n">from_db</span><span class="p">:</span>
                <span class="c1"># checking if new tags added to bookmark</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">split_and_test_membership</span><span class="p">(</span><span class="n">new_tags</span><span class="p">,</span> <span class="n">tagset</span><span class="p">))</span>
                <span class="c1"># checking if old tags still exist for boomark</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">split_and_test_membership</span><span class="p">(</span><span class="n">old_tagsets</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">tagset</span><span class="p">))</span></div>

    <span class="c1"># @unittest.skip(&#39;skipping&#39;)</span>
<div class="viewcode-block" id="TestBukuDb.test_delete_tag_at_index"><a class="viewcode-back" href="../../source/tests.html#tests.test_bukuDb.TestBukuDb.test_delete_tag_at_index">[docs]</a>    <span class="k">def</span> <span class="nf">test_delete_tag_at_index</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># adding bookmarks</span>
        <span class="k">for</span> <span class="n">bookmark</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bookmarks</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="o">.</span><span class="n">add_rec</span><span class="p">(</span><span class="o">*</span><span class="n">bookmark</span><span class="p">)</span>

        <span class="n">get_tags_at_idx</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="o">.</span><span class="n">get_rec_by_id</span><span class="p">(</span><span class="n">i</span><span class="p">)[</span><span class="mi">3</span><span class="p">]</span>
        <span class="c1"># list of two-tuples, each containg bookmark index and corresponding tags</span>
        <span class="n">tags_by_index</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i</span><span class="p">,</span> <span class="n">get_tags_at_idx</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">inclusive_range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bookmarks</span><span class="p">))]</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">tags</span> <span class="ow">in</span> <span class="n">tags_by_index</span><span class="p">:</span>
            <span class="c1"># get the first tag from the bookmark</span>
            <span class="n">to_delete</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">&#39;,.*?,&#39;</span><span class="p">,</span> <span class="n">tags</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="o">.</span><span class="n">delete_tag_at_index</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">to_delete</span><span class="p">)</span>
            <span class="c1"># get updated tags from db</span>
            <span class="n">from_db</span> <span class="o">=</span> <span class="n">get_tags_at_idx</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="n">to_delete</span><span class="p">,</span> <span class="n">from_db</span><span class="p">)</span></div>

    <span class="c1"># @unittest.skip(&#39;skipping&#39;)</span>
<div class="viewcode-block" id="TestBukuDb.test_refreshdb"><a class="viewcode-back" href="../../source/tests.html#tests.test_bukuDb.TestBukuDb.test_refreshdb">[docs]</a>    <span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">slowtest</span>
    <span class="k">def</span> <span class="nf">test_refreshdb</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="o">.</span><span class="n">add_rec</span><span class="p">(</span><span class="s2">&quot;https://www.google.com/ncr&quot;</span><span class="p">,</span> <span class="s2">&quot;?&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="o">.</span><span class="n">refreshdb</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">from_db</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="o">.</span><span class="n">get_rec_by_id</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">from_db</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="s2">&quot;Google&quot;</span><span class="p">)</span></div>

    <span class="c1"># @unittest.skip(&#39;skipping&#39;)</span>
<div class="viewcode-block" id="TestBukuDb.test_searchdb"><a class="viewcode-back" href="../../source/tests.html#tests.test_bukuDb.TestBukuDb.test_searchdb">[docs]</a>    <span class="k">def</span> <span class="nf">test_searchdb</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># adding bookmarks</span>
        <span class="k">for</span> <span class="n">bookmark</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bookmarks</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="o">.</span><span class="n">add_rec</span><span class="p">(</span><span class="o">*</span><span class="n">bookmark</span><span class="p">)</span>

        <span class="n">get_first_tag</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[:</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">bookmark</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bookmarks</span><span class="p">):</span>
            <span class="n">tag_search</span> <span class="o">=</span> <span class="n">get_first_tag</span><span class="p">(</span><span class="n">bookmark</span><span class="p">)</span>
            <span class="c1"># search by the domain name for url</span>
            <span class="n">url_search</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">&#39;https?://(.*)?\..*&#39;</span><span class="p">,</span> <span class="n">bookmark</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">title_search</span> <span class="o">=</span> <span class="n">bookmark</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="c1"># Expect a five-tuple containing all bookmark data</span>
            <span class="c1"># db index, URL, title, tags, description</span>
            <span class="n">expected</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,)</span> <span class="o">+</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">bookmark</span><span class="p">)]</span>
            <span class="c1"># search db by tag, url (domain name), and title</span>
            <span class="k">for</span> <span class="n">keyword</span> <span class="ow">in</span> <span class="p">(</span><span class="n">tag_search</span><span class="p">,</span> <span class="n">url_search</span><span class="p">,</span> <span class="n">title_search</span><span class="p">):</span>
                <span class="k">with</span> <span class="n">mock</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s1">&#39;buku.prompt&#39;</span><span class="p">):</span>
                    <span class="c1"># search by keyword</span>
                    <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="o">.</span><span class="n">searchdb</span><span class="p">([</span><span class="n">keyword</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">expected</span><span class="p">)</span></div>

    <span class="c1"># @unittest.skip(&#39;skipping&#39;)</span>
<div class="viewcode-block" id="TestBukuDb.test_search_by_tag"><a class="viewcode-back" href="../../source/tests.html#tests.test_bukuDb.TestBukuDb.test_search_by_tag">[docs]</a>    <span class="k">def</span> <span class="nf">test_search_by_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># adding bookmarks</span>
        <span class="k">for</span> <span class="n">bookmark</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bookmarks</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="o">.</span><span class="n">add_rec</span><span class="p">(</span><span class="o">*</span><span class="n">bookmark</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">mock</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s1">&#39;buku.prompt&#39;</span><span class="p">):</span>
            <span class="n">get_first_tag</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[:</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bookmarks</span><span class="p">)):</span>
                <span class="c1"># search for bookmark with a tag that is known to exist</span>
                <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="o">.</span><span class="n">search_by_tag</span><span class="p">(</span><span class="n">get_first_tag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bookmarks</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
                <span class="c1"># Expect a five-tuple containing all bookmark data</span>
                <span class="c1"># db index, URL, title, tags, description</span>
                <span class="n">expected</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,)</span> <span class="o">+</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bookmarks</span><span class="p">[</span><span class="n">i</span><span class="p">])]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">expected</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestBukuDb.test_search_by_multiple_tags_search_any"><a class="viewcode-back" href="../../source/tests.html#tests.test_bukuDb.TestBukuDb.test_search_by_multiple_tags_search_any">[docs]</a>    <span class="k">def</span> <span class="nf">test_search_by_multiple_tags_search_any</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># adding bookmarks</span>
        <span class="k">for</span> <span class="n">bookmark</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bookmarks</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="o">.</span><span class="n">add_rec</span><span class="p">(</span><span class="o">*</span><span class="n">bookmark</span><span class="p">)</span>

        <span class="n">new_bookmark</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;https://newbookmark.com&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;New Bookmark&#39;</span><span class="p">,</span>
                        <span class="n">parse_tags</span><span class="p">([</span><span class="s1">&#39;test,old,new&#39;</span><span class="p">]),</span>
                        <span class="s1">&#39;additional bookmark to test multiple tag search&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="o">.</span><span class="n">add_rec</span><span class="p">(</span><span class="o">*</span><span class="n">new_bookmark</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">mock</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s1">&#39;buku.prompt&#39;</span><span class="p">):</span>
            <span class="c1"># search for bookmarks matching ANY of the supplied tags</span>
            <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="o">.</span><span class="n">search_by_tag</span><span class="p">(</span><span class="s1">&#39;test, old&#39;</span><span class="p">)</span>
            <span class="c1"># Expect a list of five-element tuples containing all bookmark data</span>
            <span class="c1"># db index, URL, title, tags, description</span>
            <span class="n">expected</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;http://slashdot.org&#39;</span><span class="p">,</span> <span class="s1">&#39;SLASHDOT&#39;</span><span class="p">,</span>
                 <span class="n">parse_tags</span><span class="p">([</span><span class="s1">&#39;,news,old,&#39;</span><span class="p">]),</span>
                 <span class="s2">&quot;News for old nerds, stuff that doesn&#39;t matter&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;https://test.com:8080&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span>
                 <span class="n">parse_tags</span><span class="p">([</span><span class="s1">&#39;,test,tes,est,es,&#39;</span><span class="p">]),</span>
                 <span class="s2">&quot;a case for replace_tag test&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;https://newbookmark.com&#39;</span><span class="p">,</span> <span class="s1">&#39;New Bookmark&#39;</span><span class="p">,</span>
                 <span class="n">parse_tags</span><span class="p">([</span><span class="s1">&#39;,test,old,new,&#39;</span><span class="p">]),</span>
                 <span class="s1">&#39;additional bookmark to test multiple tag search&#39;</span><span class="p">)</span>
            <span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">expected</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestBukuDb.test_search_by_multiple_tags_search_all"><a class="viewcode-back" href="../../source/tests.html#tests.test_bukuDb.TestBukuDb.test_search_by_multiple_tags_search_all">[docs]</a>    <span class="k">def</span> <span class="nf">test_search_by_multiple_tags_search_all</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># adding bookmarks</span>
        <span class="k">for</span> <span class="n">bookmark</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bookmarks</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="o">.</span><span class="n">add_rec</span><span class="p">(</span><span class="o">*</span><span class="n">bookmark</span><span class="p">)</span>

        <span class="n">new_bookmark</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;https://newbookmark.com&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;New Bookmark&#39;</span><span class="p">,</span>
                        <span class="n">parse_tags</span><span class="p">([</span><span class="s1">&#39;test,old,new&#39;</span><span class="p">]),</span>
                        <span class="s1">&#39;additional bookmark to test multiple tag search&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="o">.</span><span class="n">add_rec</span><span class="p">(</span><span class="o">*</span><span class="n">new_bookmark</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">mock</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s1">&#39;buku.prompt&#39;</span><span class="p">):</span>
            <span class="c1"># search for bookmarks matching ALL of the supplied tags</span>
            <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="o">.</span><span class="n">search_by_tag</span><span class="p">(</span><span class="s1">&#39;test + old&#39;</span><span class="p">)</span>
            <span class="c1"># Expect a list of five-element tuples containing all bookmark data</span>
            <span class="c1"># db index, URL, title, tags, description</span>
            <span class="n">expected</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;https://newbookmark.com&#39;</span><span class="p">,</span> <span class="s1">&#39;New Bookmark&#39;</span><span class="p">,</span>
                 <span class="n">parse_tags</span><span class="p">([</span><span class="s1">&#39;,test,old,new,&#39;</span><span class="p">]),</span>
                 <span class="s1">&#39;additional bookmark to test multiple tag search&#39;</span><span class="p">)</span>
            <span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">expected</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestBukuDb.test_search_by_tags_enforces_space_seprations_search_all"><a class="viewcode-back" href="../../source/tests.html#tests.test_bukuDb.TestBukuDb.test_search_by_tags_enforces_space_seprations_search_all">[docs]</a>    <span class="k">def</span> <span class="nf">test_search_by_tags_enforces_space_seprations_search_all</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">bookmark1</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;https://bookmark1.com&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;Bookmark One&#39;</span><span class="p">,</span>
                     <span class="n">parse_tags</span><span class="p">([</span><span class="s1">&#39;tag, two,tag+two&#39;</span><span class="p">]),</span>
                     <span class="s2">&quot;test case for bookmark with &#39;+&#39; in tag&quot;</span><span class="p">]</span>

        <span class="n">bookmark2</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;https://bookmark2.com&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;Bookmark Two&#39;</span><span class="p">,</span>
                     <span class="n">parse_tags</span><span class="p">([</span><span class="s1">&#39;tag,two, tag-two&#39;</span><span class="p">]),</span>
                     <span class="s2">&quot;test case for bookmark with hyphenated tag&quot;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="o">.</span><span class="n">add_rec</span><span class="p">(</span><span class="o">*</span><span class="n">bookmark1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="o">.</span><span class="n">add_rec</span><span class="p">(</span><span class="o">*</span><span class="n">bookmark2</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">mock</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s1">&#39;buku.prompt&#39;</span><span class="p">):</span>
            <span class="c1"># check that space separation for &#39; + &#39; operator is enforced</span>
            <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="o">.</span><span class="n">search_by_tag</span><span class="p">(</span><span class="s1">&#39;tag+two&#39;</span><span class="p">)</span>
            <span class="c1"># Expect a list of five-element tuples containing all bookmark data</span>
            <span class="c1"># db index, URL, title, tags, description</span>
            <span class="n">expected</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;https://bookmark1.com&#39;</span><span class="p">,</span> <span class="s1">&#39;Bookmark One&#39;</span><span class="p">,</span>
                 <span class="n">parse_tags</span><span class="p">([</span><span class="s1">&#39;,tag,two,tag+two,&#39;</span><span class="p">]),</span>
                 <span class="s2">&quot;test case for bookmark with &#39;+&#39; in tag&quot;</span><span class="p">)</span>
            <span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">expected</span><span class="p">)</span>
            <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="o">.</span><span class="n">search_by_tag</span><span class="p">(</span><span class="s1">&#39;tag + two&#39;</span><span class="p">)</span>
            <span class="c1"># Expect a list of five-element tuples containing all bookmark data</span>
            <span class="c1"># db index, URL, title, tags, description</span>
            <span class="n">expected</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;https://bookmark1.com&#39;</span><span class="p">,</span> <span class="s1">&#39;Bookmark One&#39;</span><span class="p">,</span>
                 <span class="n">parse_tags</span><span class="p">([</span><span class="s1">&#39;,tag,two,tag+two,&#39;</span><span class="p">]),</span>
                 <span class="s2">&quot;test case for bookmark with &#39;+&#39; in tag&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;https://bookmark2.com&#39;</span><span class="p">,</span> <span class="s1">&#39;Bookmark Two&#39;</span><span class="p">,</span>
                 <span class="n">parse_tags</span><span class="p">([</span><span class="s1">&#39;,tag,two,tag-two,&#39;</span><span class="p">]),</span>
                 <span class="s2">&quot;test case for bookmark with hyphenated tag&quot;</span><span class="p">),</span>
            <span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">expected</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestBukuDb.test_search_by_tags_exclusion"><a class="viewcode-back" href="../../source/tests.html#tests.test_bukuDb.TestBukuDb.test_search_by_tags_exclusion">[docs]</a>    <span class="k">def</span> <span class="nf">test_search_by_tags_exclusion</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># adding bookmarks</span>
        <span class="k">for</span> <span class="n">bookmark</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bookmarks</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="o">.</span><span class="n">add_rec</span><span class="p">(</span><span class="o">*</span><span class="n">bookmark</span><span class="p">)</span>

        <span class="n">new_bookmark</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;https://newbookmark.com&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;New Bookmark&#39;</span><span class="p">,</span>
                        <span class="n">parse_tags</span><span class="p">([</span><span class="s1">&#39;test,old,new&#39;</span><span class="p">]),</span>
                        <span class="s1">&#39;additional bookmark to test multiple tag search&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="o">.</span><span class="n">add_rec</span><span class="p">(</span><span class="o">*</span><span class="n">new_bookmark</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">mock</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s1">&#39;buku.prompt&#39;</span><span class="p">):</span>
            <span class="c1"># search for bookmarks matching ANY of the supplied tags</span>
            <span class="c1"># while excluding bookmarks from results that match a given tag</span>
            <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="o">.</span><span class="n">search_by_tag</span><span class="p">(</span><span class="s1">&#39;test, old - est&#39;</span><span class="p">)</span>
            <span class="c1"># Expect a list of five-element tuples containing all bookmark data</span>
            <span class="c1"># db index, URL, title, tags, description</span>
            <span class="n">expected</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;http://slashdot.org&#39;</span><span class="p">,</span> <span class="s1">&#39;SLASHDOT&#39;</span><span class="p">,</span>
                 <span class="n">parse_tags</span><span class="p">([</span><span class="s1">&#39;,news,old,&#39;</span><span class="p">]),</span>
                 <span class="s2">&quot;News for old nerds, stuff that doesn&#39;t matter&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;https://newbookmark.com&#39;</span><span class="p">,</span> <span class="s1">&#39;New Bookmark&#39;</span><span class="p">,</span>
                 <span class="n">parse_tags</span><span class="p">([</span><span class="s1">&#39;,test,old,new,&#39;</span><span class="p">]),</span>
                 <span class="s1">&#39;additional bookmark to test multiple tag search&#39;</span><span class="p">)</span>
            <span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">expected</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestBukuDb.test_search_by_tags_enforces_space_seprations_exclusion"><a class="viewcode-back" href="../../source/tests.html#tests.test_bukuDb.TestBukuDb.test_search_by_tags_enforces_space_seprations_exclusion">[docs]</a>    <span class="k">def</span> <span class="nf">test_search_by_tags_enforces_space_seprations_exclusion</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">bookmark1</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;https://bookmark1.com&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;Bookmark One&#39;</span><span class="p">,</span>
                     <span class="n">parse_tags</span><span class="p">([</span><span class="s1">&#39;tag, two,tag+two&#39;</span><span class="p">]),</span>
                     <span class="s2">&quot;test case for bookmark with &#39;+&#39; in tag&quot;</span><span class="p">]</span>

        <span class="n">bookmark2</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;https://bookmark2.com&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;Bookmark Two&#39;</span><span class="p">,</span>
                     <span class="n">parse_tags</span><span class="p">([</span><span class="s1">&#39;tag,two, tag-two&#39;</span><span class="p">]),</span>
                     <span class="s2">&quot;test case for bookmark with hyphenated tag&quot;</span><span class="p">]</span>

        <span class="n">bookmark3</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;https://bookmark3.com&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;Bookmark Three&#39;</span><span class="p">,</span>
                     <span class="n">parse_tags</span><span class="p">([</span><span class="s1">&#39;tag, tag three&#39;</span><span class="p">]),</span>
                     <span class="s2">&quot;second test case for bookmark with hyphenated tag&quot;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="o">.</span><span class="n">add_rec</span><span class="p">(</span><span class="o">*</span><span class="n">bookmark1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="o">.</span><span class="n">add_rec</span><span class="p">(</span><span class="o">*</span><span class="n">bookmark2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="o">.</span><span class="n">add_rec</span><span class="p">(</span><span class="o">*</span><span class="n">bookmark3</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">mock</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s1">&#39;buku.prompt&#39;</span><span class="p">):</span>
            <span class="c1"># check that space separation for &#39; - &#39; operator is enforced</span>
            <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="o">.</span><span class="n">search_by_tag</span><span class="p">(</span><span class="s1">&#39;tag-two&#39;</span><span class="p">)</span>
            <span class="c1"># Expect a list of five-element tuples containing all bookmark data</span>
            <span class="c1"># db index, URL, title, tags, description</span>
            <span class="n">expected</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;https://bookmark2.com&#39;</span><span class="p">,</span> <span class="s1">&#39;Bookmark Two&#39;</span><span class="p">,</span>
                 <span class="n">parse_tags</span><span class="p">([</span><span class="s1">&#39;,tag,two,tag-two,&#39;</span><span class="p">]),</span>
                 <span class="s2">&quot;test case for bookmark with hyphenated tag&quot;</span><span class="p">),</span>
            <span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">expected</span><span class="p">)</span>
            <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="o">.</span><span class="n">search_by_tag</span><span class="p">(</span><span class="s1">&#39;tag - two&#39;</span><span class="p">)</span>
            <span class="c1"># Expect a list of five-element tuples containing all bookmark data</span>
            <span class="c1"># db index, URL, title, tags, description</span>
            <span class="n">expected</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;https://bookmark3.com&#39;</span><span class="p">,</span> <span class="s1">&#39;Bookmark Three&#39;</span><span class="p">,</span>
                 <span class="n">parse_tags</span><span class="p">([</span><span class="s1">&#39;,tag,tag three,&#39;</span><span class="p">]),</span>
                 <span class="s2">&quot;second test case for bookmark with hyphenated tag&quot;</span><span class="p">),</span>
            <span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">expected</span><span class="p">)</span></div>

    <span class="c1"># @unittest.skip(&#39;skipping&#39;)</span>
<div class="viewcode-block" id="TestBukuDb.test_search_and_open_in_broswer_by_range"><a class="viewcode-back" href="../../source/tests.html#tests.test_bukuDb.TestBukuDb.test_search_and_open_in_broswer_by_range">[docs]</a>    <span class="k">def</span> <span class="nf">test_search_and_open_in_broswer_by_range</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># adding bookmarks</span>
        <span class="k">for</span> <span class="n">bookmark</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bookmarks</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="o">.</span><span class="n">add_rec</span><span class="p">(</span><span class="o">*</span><span class="n">bookmark</span><span class="p">)</span>

        <span class="c1"># simulate user input, select range of indices 1-3</span>
        <span class="n">index_range</span> <span class="o">=</span> <span class="s1">&#39;1-</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bookmarks</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">mock</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s1">&#39;builtins.input&#39;</span><span class="p">,</span> <span class="n">side_effect</span><span class="o">=</span><span class="p">[</span><span class="n">index_range</span><span class="p">]):</span>
            <span class="k">with</span> <span class="n">mock</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s1">&#39;buku.browse&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_browse</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># search the db with keywords from each bookmark</span>
                    <span class="c1"># searching using the first tag from bookmarks</span>
                    <span class="n">get_first_tag</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="o">.</span><span class="n">searchdb</span><span class="p">([</span><span class="n">get_first_tag</span><span class="p">(</span><span class="n">bm</span><span class="p">)</span> <span class="k">for</span> <span class="n">bm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bookmarks</span><span class="p">])</span>
                    <span class="n">prompt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="p">,</span> <span class="n">results</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
                    <span class="c1"># catch exception thrown by reaching the end of the side effect iterable</span>
                    <span class="k">pass</span>

                <span class="c1"># collect arguments passed to browse</span>
                <span class="n">arg_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">args</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">mock_browse</span><span class="o">.</span><span class="n">call_args_list</span><span class="p">]</span>
                <span class="c1"># expect a list of one-tuples that are bookmark URLs</span>
                <span class="n">expected</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bookmarks</span><span class="p">]</span>
                <span class="c1"># checking if browse called with expected arguments</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">arg_list</span><span class="p">,</span> <span class="n">expected</span><span class="p">)</span></div>

    <span class="c1"># @unittest.skip(&#39;skipping&#39;)</span>
<div class="viewcode-block" id="TestBukuDb.test_search_and_open_all_in_browser"><a class="viewcode-back" href="../../source/tests.html#tests.test_bukuDb.TestBukuDb.test_search_and_open_all_in_browser">[docs]</a>    <span class="k">def</span> <span class="nf">test_search_and_open_all_in_browser</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># adding bookmarks</span>
        <span class="k">for</span> <span class="n">bookmark</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bookmarks</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="o">.</span><span class="n">add_rec</span><span class="p">(</span><span class="o">*</span><span class="n">bookmark</span><span class="p">)</span>

        <span class="c1"># simulate user input, select &#39;a&#39; to open all bookmarks in results</span>
        <span class="k">with</span> <span class="n">mock</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s1">&#39;builtins.input&#39;</span><span class="p">,</span> <span class="n">side_effect</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]):</span>
            <span class="k">with</span> <span class="n">mock</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s1">&#39;buku.browse&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_browse</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># search the db with keywords from each bookmark</span>
                    <span class="c1"># searching using the first tag from bookmarks</span>
                    <span class="n">get_first_tag</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="o">.</span><span class="n">searchdb</span><span class="p">([</span><span class="n">get_first_tag</span><span class="p">(</span><span class="n">bm</span><span class="p">)</span> <span class="k">for</span> <span class="n">bm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bookmarks</span><span class="p">[:</span><span class="mi">2</span><span class="p">]])</span>
                    <span class="n">prompt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="p">,</span> <span class="n">results</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
                    <span class="c1"># catch exception thrown by reaching the end of the side effect iterable</span>
                    <span class="k">pass</span>

                <span class="c1"># collect arguments passed to browse</span>
                <span class="n">arg_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">args</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">mock_browse</span><span class="o">.</span><span class="n">call_args_list</span><span class="p">]</span>
                <span class="c1"># expect a list of one-tuples that are bookmark URLs</span>
                <span class="n">expected</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bookmarks</span><span class="p">][:</span><span class="mi">2</span><span class="p">]</span>
                <span class="c1"># checking if browse called with expected arguments</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">arg_list</span><span class="p">,</span> <span class="n">expected</span><span class="p">)</span></div>

    <span class="c1"># @unittest.skip(&#39;skipping&#39;)</span>
<div class="viewcode-block" id="TestBukuDb.test_delete_rec"><a class="viewcode-back" href="../../source/tests.html#tests.test_bukuDb.TestBukuDb.test_delete_rec">[docs]</a>    <span class="k">def</span> <span class="nf">test_delete_rec</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># adding bookmark and getting index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="o">.</span><span class="n">add_rec</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">bookmarks</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="o">.</span><span class="n">get_rec_id</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bookmarks</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="c1"># deleting bookmark</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="o">.</span><span class="n">delete_rec</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="c1"># asserting it doesn&#39;t exist</span>
        <span class="n">from_db</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="o">.</span><span class="n">get_rec_by_id</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">from_db</span><span class="p">)</span></div>

    <span class="c1"># @unittest.skip(&#39;skipping&#39;)</span>
<div class="viewcode-block" id="TestBukuDb.test_delete_rec_yes"><a class="viewcode-back" href="../../source/tests.html#tests.test_bukuDb.TestBukuDb.test_delete_rec_yes">[docs]</a>    <span class="k">def</span> <span class="nf">test_delete_rec_yes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># checking that &quot;y&quot; response causes delete_rec to return True</span>
        <span class="k">with</span> <span class="n">mock</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s1">&#39;builtins.input&#39;</span><span class="p">,</span> <span class="n">return_value</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="o">.</span><span class="n">delete_rec</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span></div>

    <span class="c1"># @unittest.skip(&#39;skipping&#39;)</span>
<div class="viewcode-block" id="TestBukuDb.test_delete_rec_no"><a class="viewcode-back" href="../../source/tests.html#tests.test_bukuDb.TestBukuDb.test_delete_rec_no">[docs]</a>    <span class="k">def</span> <span class="nf">test_delete_rec_no</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># checking that non-&quot;y&quot; response causes delete_rec to return None</span>
        <span class="k">with</span> <span class="n">mock</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s1">&#39;builtins.input&#39;</span><span class="p">,</span> <span class="n">return_value</span><span class="o">=</span><span class="s1">&#39;n&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="o">.</span><span class="n">delete_rec</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span></div>

    <span class="c1"># @unittest.skip(&#39;skipping&#39;)</span>
<div class="viewcode-block" id="TestBukuDb.test_cleardb"><a class="viewcode-back" href="../../source/tests.html#tests.test_bukuDb.TestBukuDb.test_cleardb">[docs]</a>    <span class="k">def</span> <span class="nf">test_cleardb</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># adding bookmarks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="o">.</span><span class="n">add_rec</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">bookmarks</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="c1"># deleting all bookmarks</span>
        <span class="k">with</span> <span class="n">mock</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s1">&#39;builtins.input&#39;</span><span class="p">,</span> <span class="n">return_value</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="o">.</span><span class="n">cleardb</span><span class="p">()</span>
        <span class="c1"># assert table has been dropped</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">sqlite3</span><span class="o">.</span><span class="n">OperationalError</span><span class="p">)</span> <span class="k">as</span> <span class="n">ctx_man</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="o">.</span><span class="n">get_rec_by_id</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">err_msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">ctx_man</span><span class="o">.</span><span class="n">exception</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">err_msg</span><span class="p">,</span> <span class="s1">&#39;no such table: bookmarks&#39;</span><span class="p">)</span></div>

    <span class="c1"># @unittest.skip(&#39;skipping&#39;)</span>
<div class="viewcode-block" id="TestBukuDb.test_replace_tag"><a class="viewcode-back" href="../../source/tests.html#tests.test_bukuDb.TestBukuDb.test_replace_tag">[docs]</a>    <span class="k">def</span> <span class="nf">test_replace_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">bookmark</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bookmarks</span><span class="p">:</span>
            <span class="c1"># adding bookmark, getting index</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="o">.</span><span class="n">add_rec</span><span class="p">(</span><span class="o">*</span><span class="n">bookmark</span><span class="p">)</span>
            <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="o">.</span><span class="n">get_rec_id</span><span class="p">(</span><span class="n">bookmark</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">indices</span> <span class="o">+=</span> <span class="p">[</span><span class="n">index</span><span class="p">]</span>

        <span class="c1"># replacing tags</span>
        <span class="k">with</span> <span class="n">mock</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s1">&#39;builtins.input&#39;</span><span class="p">,</span> <span class="n">return_value</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="o">.</span><span class="n">replace_tag</span><span class="p">(</span><span class="s2">&quot;news&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;__01&quot;</span><span class="p">])</span>
        <span class="k">with</span> <span class="n">mock</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s1">&#39;builtins.input&#39;</span><span class="p">,</span> <span class="n">return_value</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="o">.</span><span class="n">replace_tag</span><span class="p">(</span><span class="s2">&quot;zażółć&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;__02,__03&quot;</span><span class="p">])</span>

        <span class="c1"># replacing tag which is also a substring of other tag</span>
        <span class="k">with</span> <span class="n">mock</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s1">&#39;builtins.input&#39;</span><span class="p">,</span> <span class="n">return_value</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="o">.</span><span class="n">replace_tag</span><span class="p">(</span><span class="s2">&quot;es&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;__04&quot;</span><span class="p">])</span>

        <span class="c1"># removing tags</span>
        <span class="k">with</span> <span class="n">mock</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s1">&#39;builtins.input&#39;</span><span class="p">,</span> <span class="n">return_value</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="o">.</span><span class="n">replace_tag</span><span class="p">(</span><span class="s2">&quot;gęślą&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">mock</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s1">&#39;builtins.input&#39;</span><span class="p">,</span> <span class="n">return_value</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="o">.</span><span class="n">replace_tag</span><span class="p">(</span><span class="s2">&quot;old&quot;</span><span class="p">)</span>

        <span class="c1"># removing non-existent tag</span>
        <span class="k">with</span> <span class="n">mock</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s1">&#39;builtins.input&#39;</span><span class="p">,</span> <span class="n">return_value</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="o">.</span><span class="n">replace_tag</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>

        <span class="c1"># removing nonexistent tag which is also a substring of other tag</span>
        <span class="k">with</span> <span class="n">mock</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s1">&#39;builtins.input&#39;</span><span class="p">,</span> <span class="n">return_value</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="o">.</span><span class="n">replace_tag</span><span class="p">(</span><span class="s2">&quot;e&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">url</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bookmarks</span><span class="p">:</span>
            <span class="c1"># retrieving from db</span>
            <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="o">.</span><span class="n">get_rec_id</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="n">from_db</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="o">.</span><span class="n">get_rec_by_id</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
            <span class="c1"># asserting tags were replaced</span>
            <span class="k">if</span> <span class="n">title</span> <span class="o">==</span> <span class="s2">&quot;SLASHDOT&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">from_db</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">parse_tags</span><span class="p">([</span><span class="s2">&quot;__01&quot;</span><span class="p">]))</span>
            <span class="k">elif</span> <span class="n">title</span> <span class="o">==</span> <span class="s2">&quot;ZAŻÓŁĆ&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">from_db</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">parse_tags</span><span class="p">([</span><span class="s2">&quot;__02,__03,jaźń&quot;</span><span class="p">]))</span>
            <span class="k">elif</span> <span class="n">title</span> <span class="o">==</span> <span class="s2">&quot;test&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">from_db</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">parse_tags</span><span class="p">([</span><span class="s2">&quot;test,tes,est,__04&quot;</span><span class="p">]))</span></div>

    <span class="c1"># def test_browse_by_index(self):</span>
        <span class="c1"># self.fail()</span>

    <span class="c1"># @unittest.skip(&#39;skipping&#39;)</span>
<div class="viewcode-block" id="TestBukuDb.test_close_quit"><a class="viewcode-back" href="../../source/tests.html#tests.test_bukuDb.TestBukuDb.test_close_quit">[docs]</a>    <span class="k">def</span> <span class="nf">test_close_quit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># quitting with no args</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="o">.</span><span class="n">close_quit</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">SystemExit</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">err</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
        <span class="c1"># quitting with custom arg</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bdb</span><span class="o">.</span><span class="n">close_quit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">SystemExit</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">err</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span></div></div>

    <span class="c1"># def test_import_bookmark(self):</span>
        <span class="c1"># self.fail()</span>

<div class="viewcode-block" id="test_print_rec_hypothesis"><a class="viewcode-back" href="../../source/tests.html#tests.test_bukuDb.test_print_rec_hypothesis">[docs]</a><span class="nd">@given</span><span class="p">(</span>
    <span class="n">index</span><span class="o">=</span><span class="n">st</span><span class="o">.</span><span class="n">integers</span><span class="p">(</span><span class="n">min_value</span><span class="o">=-</span><span class="mi">10</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span>
    <span class="n">low</span><span class="o">=</span><span class="n">st</span><span class="o">.</span><span class="n">integers</span><span class="p">(</span><span class="n">min_value</span><span class="o">=-</span><span class="mi">10</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span>
    <span class="n">high</span><span class="o">=</span><span class="n">st</span><span class="o">.</span><span class="n">integers</span><span class="p">(</span><span class="n">min_value</span><span class="o">=-</span><span class="mi">10</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span>
    <span class="n">is_range</span><span class="o">=</span><span class="n">st</span><span class="o">.</span><span class="n">booleans</span><span class="p">(),</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">test_print_rec_hypothesis</span><span class="p">(</span><span class="n">caplog</span><span class="p">,</span> <span class="n">setup</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">,</span> <span class="n">is_range</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;test when index, low or high is less than 0.&quot;&quot;&quot;</span>
    <span class="c1"># setup</span>
    <span class="n">caplog</span><span class="o">.</span><span class="n">handler</span><span class="o">.</span><span class="n">records</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
    <span class="n">caplog</span><span class="o">.</span><span class="n">records</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="n">bdb</span> <span class="o">=</span> <span class="n">BukuDb</span><span class="p">()</span>
    <span class="c1"># clear all record first before testing</span>
    <span class="n">bdb</span><span class="o">.</span><span class="n">delete_rec_all</span><span class="p">()</span>
    <span class="n">bdb</span><span class="o">.</span><span class="n">add_rec</span><span class="p">(</span><span class="s2">&quot;http://one.com&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">parse_tags</span><span class="p">([</span><span class="s1">&#39;cat,ant,bee,1&#39;</span><span class="p">]),</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">db_len</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">bdb</span><span class="o">.</span><span class="n">print_rec</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">low</span><span class="o">=</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="n">high</span><span class="p">,</span> <span class="n">is_range</span><span class="o">=</span><span class="n">is_range</span><span class="p">)</span>

    <span class="n">check_print</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">err_msg</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Actual log:&#39;</span><span class="p">]</span>
    <span class="n">err_msg</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">levelname</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">getMessage</span><span class="p">())</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">caplog</span><span class="o">.</span><span class="n">records</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">index</span> <span class="o">&lt;=</span> <span class="n">db_len</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_range</span><span class="p">):</span>
        <span class="n">check_print</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="c1"># negative index/range on is_range</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">is_range</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">([</span><span class="n">low</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">high</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">])):</span>
        <span class="k">assert</span> <span class="nb">any</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">levelname</span> <span class="o">==</span> <span class="s2">&quot;ERROR&quot;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">caplog</span><span class="o">.</span><span class="n">records</span><span class="p">]),</span> \
            <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">any</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">getMessage</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Negative range boundary&quot;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">caplog</span><span class="o">.</span><span class="n">records</span><span class="p">]),</span> \
            <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">is_range</span><span class="p">:</span>
        <span class="n">check_print</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">any</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">levelname</span> <span class="o">==</span> <span class="s2">&quot;ERROR&quot;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">caplog</span><span class="o">.</span><span class="n">records</span><span class="p">]),</span> \
            <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">any</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">getMessage</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;No matching index&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">caplog</span><span class="o">.</span><span class="n">records</span><span class="p">]),</span> \
            <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">check_print</span><span class="p">:</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">levelname</span> <span class="o">==</span> <span class="s2">&quot;ERROR&quot;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">caplog</span><span class="o">.</span><span class="n">records</span><span class="p">]),</span> \
            <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>

    <span class="c1"># teardown</span>
    <span class="n">bdb</span><span class="o">.</span><span class="n">delete_rec</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">caplog</span><span class="o">.</span><span class="n">handler</span><span class="o">.</span><span class="n">records</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
    <span class="n">caplog</span><span class="o">.</span><span class="n">records</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span></div>


<div class="viewcode-block" id="test_list_tags"><a class="viewcode-back" href="../../source/tests.html#tests.test_bukuDb.test_list_tags">[docs]</a><span class="k">def</span> <span class="nf">test_list_tags</span><span class="p">(</span><span class="n">capsys</span><span class="p">,</span> <span class="n">setup</span><span class="p">):</span>
    <span class="n">bdb</span> <span class="o">=</span> <span class="n">BukuDb</span><span class="p">()</span>

    <span class="c1"># adding bookmarks</span>
    <span class="n">bdb</span><span class="o">.</span><span class="n">add_rec</span><span class="p">(</span><span class="s2">&quot;http://one.com&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">parse_tags</span><span class="p">([</span><span class="s1">&#39;cat,ant,bee,1&#39;</span><span class="p">]),</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">bdb</span><span class="o">.</span><span class="n">add_rec</span><span class="p">(</span><span class="s2">&quot;http://two.com&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">parse_tags</span><span class="p">([</span><span class="s1">&#39;Cat,Ant,bee,1&#39;</span><span class="p">]),</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">bdb</span><span class="o">.</span><span class="n">add_rec</span><span class="p">(</span><span class="s2">&quot;http://three.com&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">parse_tags</span><span class="p">([</span><span class="s1">&#39;Cat,Ant,3,Bee,2&#39;</span><span class="p">]),</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="c1"># listing tags, asserting output</span>
    <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">capsys</span><span class="o">.</span><span class="n">readouterr</span><span class="p">()</span>
    <span class="n">prompt</span><span class="p">(</span><span class="n">bdb</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="n">subprompt</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">capsys</span><span class="o">.</span><span class="n">readouterr</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">out</span> <span class="o">==</span> <span class="s2">&quot;     1. 1 (2)</span><span class="se">\n</span><span class="s2">     2. 2 (1)</span><span class="se">\n</span><span class="s2">     3. 3 (1)</span><span class="se">\n</span><span class="s2">     4. ant (3)</span><span class="se">\n</span><span class="s2">     5. bee (3)</span><span class="se">\n</span><span class="s2">     6. cat (3)</span><span class="se">\n\n</span><span class="s2">&quot;</span>
    <span class="k">assert</span> <span class="n">err</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span></div>


<div class="viewcode-block" id="test_compactdb"><a class="viewcode-back" href="../../source/tests.html#tests.test_bukuDb.test_compactdb">[docs]</a><span class="k">def</span> <span class="nf">test_compactdb</span><span class="p">(</span><span class="n">setup</span><span class="p">):</span>
    <span class="n">bdb</span> <span class="o">=</span> <span class="n">BukuDb</span><span class="p">()</span>

    <span class="c1"># adding bookmarks</span>
    <span class="k">for</span> <span class="n">bookmark</span> <span class="ow">in</span> <span class="n">TEST_BOOKMARKS</span><span class="p">:</span>
        <span class="n">bdb</span><span class="o">.</span><span class="n">add_rec</span><span class="p">(</span><span class="o">*</span><span class="n">bookmark</span><span class="p">)</span>

    <span class="c1"># manually deleting 2nd index from db, calling compactdb</span>
    <span class="n">bdb</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;DELETE FROM bookmarks WHERE id = ?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,))</span>
    <span class="n">bdb</span><span class="o">.</span><span class="n">compactdb</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># asserting bookmarks have correct indices</span>
    <span class="k">assert</span> <span class="n">bdb</span><span class="o">.</span><span class="n">get_rec_by_id</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;http://slashdot.org&#39;</span><span class="p">,</span> <span class="s1">&#39;SLASHDOT&#39;</span><span class="p">,</span> <span class="s1">&#39;,news,old,&#39;</span><span class="p">,</span> <span class="s2">&quot;News for old nerds, stuff that doesn&#39;t matter&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">bdb</span><span class="o">.</span><span class="n">get_rec_by_id</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;https://test.com:8080&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;,es,est,tes,test,&#39;</span><span class="p">,</span> <span class="s1">&#39;a case for replace_tag test&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">bdb</span><span class="o">.</span><span class="n">get_rec_by_id</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="test_delete_rec_range_and_delay_commit"><a class="viewcode-back" href="../../source/tests.html#tests.test_bukuDb.test_delete_rec_range_and_delay_commit">[docs]</a><span class="nd">@given</span><span class="p">(</span>
    <span class="n">low</span><span class="o">=</span><span class="n">st</span><span class="o">.</span><span class="n">integers</span><span class="p">(</span><span class="n">min_value</span><span class="o">=-</span><span class="mi">10</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span>
    <span class="n">high</span><span class="o">=</span><span class="n">st</span><span class="o">.</span><span class="n">integers</span><span class="p">(</span><span class="n">min_value</span><span class="o">=-</span><span class="mi">10</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span>
    <span class="n">delay_commit</span><span class="o">=</span><span class="n">st</span><span class="o">.</span><span class="n">booleans</span><span class="p">(),</span>
    <span class="n">input_retval</span><span class="o">=</span><span class="n">st</span><span class="o">.</span><span class="n">characters</span><span class="p">()</span>
<span class="p">)</span>
<span class="nd">@example</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">delay_commit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">input_retval</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_delete_rec_range_and_delay_commit</span><span class="p">(</span><span class="n">setup</span><span class="p">,</span> <span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">,</span> <span class="n">delay_commit</span><span class="p">,</span> <span class="n">input_retval</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;test delete rec, range and delay commit.&quot;&quot;&quot;</span>
    <span class="n">bdb</span> <span class="o">=</span> <span class="n">BukuDb</span><span class="p">()</span>
    <span class="n">bdb_dc</span> <span class="o">=</span> <span class="n">BukuDb</span><span class="p">()</span>  <span class="c1"># instance for delay_commit check.</span>
    <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">is_range</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># Fill bookmark</span>
    <span class="k">for</span> <span class="n">bookmark</span> <span class="ow">in</span> <span class="n">TEST_BOOKMARKS</span><span class="p">:</span>
        <span class="n">bdb</span><span class="o">.</span><span class="n">add_rec</span><span class="p">(</span><span class="o">*</span><span class="n">bookmark</span><span class="p">)</span>
    <span class="n">db_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">TEST_BOOKMARKS</span><span class="p">)</span>

    <span class="c1"># use normalized high and low variable</span>
    <span class="n">n_low</span><span class="p">,</span> <span class="n">n_high</span> <span class="o">=</span> <span class="n">normalize_range</span><span class="p">(</span><span class="n">db_len</span><span class="o">=</span><span class="n">db_len</span><span class="p">,</span> <span class="n">low</span><span class="o">=</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="n">high</span><span class="p">)</span>

    <span class="n">exp_res</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">n_high</span> <span class="o">&gt;</span> <span class="n">db_len</span> <span class="ow">and</span> <span class="n">n_low</span> <span class="o">&lt;=</span> <span class="n">db_len</span><span class="p">:</span>
        <span class="n">exp_db_len</span> <span class="o">=</span> <span class="n">db_len</span> <span class="o">-</span> <span class="p">(</span><span class="n">db_len</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">n_low</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">n_high</span> <span class="o">==</span> <span class="n">n_low</span> <span class="ow">and</span> <span class="n">n_low</span> <span class="o">&gt;</span> <span class="n">db_len</span><span class="p">:</span>
        <span class="n">exp_db_len</span> <span class="o">=</span> <span class="n">db_len</span>
        <span class="n">exp_res</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">elif</span> <span class="n">n_high</span> <span class="o">==</span> <span class="n">n_low</span> <span class="ow">and</span> <span class="n">n_low</span> <span class="o">&lt;=</span> <span class="n">db_len</span><span class="p">:</span>
        <span class="n">exp_db_len</span> <span class="o">=</span> <span class="n">db_len</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">exp_db_len</span> <span class="o">=</span> <span class="n">db_len</span> <span class="o">-</span> <span class="p">(</span><span class="n">n_high</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">n_low</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">mock</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s1">&#39;builtins.input&#39;</span><span class="p">,</span> <span class="n">return_value</span><span class="o">=</span><span class="n">input_retval</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">bdb</span><span class="o">.</span><span class="n">delete_rec</span><span class="p">(</span>
            <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">low</span><span class="o">=</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="n">high</span><span class="p">,</span> <span class="n">is_range</span><span class="o">=</span><span class="n">is_range</span><span class="p">,</span> <span class="n">delay_commit</span><span class="o">=</span><span class="n">delay_commit</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">n_low</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="n">res</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">bdb_dc</span><span class="o">.</span><span class="n">get_rec_all</span><span class="p">())</span> <span class="o">==</span> <span class="n">db_len</span>
        <span class="c1"># teardown</span>
        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;XDG_DATA_HOME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">TEST_TEMP_DIR_PATH</span>
        <span class="k">return</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">low</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">high</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="n">input_retval</span> <span class="o">!=</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="n">res</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">bdb_dc</span><span class="o">.</span><span class="n">get_rec_all</span><span class="p">())</span> <span class="o">==</span> <span class="n">db_len</span>
        <span class="c1"># teardown</span>
        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;XDG_DATA_HOME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">TEST_TEMP_DIR_PATH</span>
        <span class="k">return</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">low</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">high</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="n">input_retval</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">res</span> <span class="o">==</span> <span class="n">exp_res</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">sqlite3</span><span class="o">.</span><span class="n">OperationalError</span><span class="p">):</span>
            <span class="n">bdb</span><span class="o">.</span><span class="n">get_rec_all</span><span class="p">()</span>
        <span class="c1"># teardown</span>
        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;XDG_DATA_HOME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">TEST_TEMP_DIR_PATH</span>
        <span class="k">return</span>
    <span class="k">elif</span> <span class="n">n_low</span> <span class="o">&gt;</span> <span class="n">db_len</span> <span class="ow">and</span> <span class="n">n_low</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="n">res</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">bdb_dc</span><span class="o">.</span><span class="n">get_rec_all</span><span class="p">())</span> <span class="o">==</span> <span class="n">db_len</span>
        <span class="c1"># teardown</span>
        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;XDG_DATA_HOME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">TEST_TEMP_DIR_PATH</span>
        <span class="k">return</span>
    <span class="k">assert</span> <span class="n">res</span> <span class="o">==</span> <span class="n">exp_res</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">bdb</span><span class="o">.</span><span class="n">get_rec_all</span><span class="p">())</span> <span class="o">==</span> <span class="n">exp_db_len</span>
    <span class="k">if</span> <span class="n">delay_commit</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">bdb_dc</span><span class="o">.</span><span class="n">get_rec_all</span><span class="p">())</span> <span class="o">==</span> <span class="n">db_len</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">bdb_dc</span><span class="o">.</span><span class="n">get_rec_all</span><span class="p">())</span> <span class="o">==</span> <span class="n">exp_db_len</span>

    <span class="c1"># teardown</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;XDG_DATA_HOME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">TEST_TEMP_DIR_PATH</span></div>


<div class="viewcode-block" id="test_delete_rec_range_and_big_int"><a class="viewcode-back" href="../../source/tests.html#tests.test_bukuDb.test_delete_rec_range_and_big_int">[docs]</a><span class="nd">@only_python_3_5</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="n">reason</span><span class="o">=</span><span class="s1">&#39;Impossible case.&#39;</span><span class="p">)</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span>
    <span class="s1">&#39;low, high&#39;</span><span class="p">,</span>
    <span class="n">product</span><span class="p">(</span>
        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">MAX_SQLITE_INT</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">MAX_SQLITE_INT</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">test_delete_rec_range_and_big_int</span><span class="p">(</span><span class="n">setup</span><span class="p">,</span> <span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;test delete rec, range and big integer.&quot;&quot;&quot;</span>
    <span class="n">bdb</span> <span class="o">=</span> <span class="n">BukuDb</span><span class="p">()</span>
    <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">is_range</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># Fill bookmark</span>
    <span class="k">for</span> <span class="n">bookmark</span> <span class="ow">in</span> <span class="n">TEST_BOOKMARKS</span><span class="p">:</span>
        <span class="n">bdb</span><span class="o">.</span><span class="n">add_rec</span><span class="p">(</span><span class="o">*</span><span class="n">bookmark</span><span class="p">)</span>
    <span class="n">db_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">TEST_BOOKMARKS</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">bdb</span><span class="o">.</span><span class="n">delete_rec</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">low</span><span class="o">=</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="n">high</span><span class="p">,</span> <span class="n">is_range</span><span class="o">=</span><span class="n">is_range</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">high</span> <span class="o">&gt;</span> <span class="n">db_len</span> <span class="ow">and</span> <span class="n">low</span> <span class="o">&gt;</span> <span class="n">db_len</span><span class="p">:</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="n">res</span>
        <span class="k">return</span>
    <span class="k">assert</span> <span class="n">res</span></div>


<div class="viewcode-block" id="test_delete_rec_index_and_delay_commit"><a class="viewcode-back" href="../../source/tests.html#tests.test_bukuDb.test_delete_rec_index_and_delay_commit">[docs]</a><span class="nd">@given</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">st</span><span class="o">.</span><span class="n">integers</span><span class="p">(),</span> <span class="n">delay_commit</span><span class="o">=</span><span class="n">st</span><span class="o">.</span><span class="n">booleans</span><span class="p">(),</span> <span class="n">input_retval</span><span class="o">=</span><span class="n">st</span><span class="o">.</span><span class="n">booleans</span><span class="p">())</span>
<span class="k">def</span> <span class="nf">test_delete_rec_index_and_delay_commit</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">delay_commit</span><span class="p">,</span> <span class="n">input_retval</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;test delete rec, index and delay commit.&quot;&quot;&quot;</span>
    <span class="n">bdb</span> <span class="o">=</span> <span class="n">BukuDb</span><span class="p">()</span>
    <span class="n">bdb_dc</span> <span class="o">=</span> <span class="n">BukuDb</span><span class="p">()</span>  <span class="c1"># instance for delay_commit check.</span>

    <span class="c1"># Fill bookmark</span>
    <span class="k">for</span> <span class="n">bookmark</span> <span class="ow">in</span> <span class="n">TEST_BOOKMARKS</span><span class="p">:</span>
        <span class="n">bdb</span><span class="o">.</span><span class="n">add_rec</span><span class="p">(</span><span class="o">*</span><span class="n">bookmark</span><span class="p">)</span>
    <span class="n">db_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">TEST_BOOKMARKS</span><span class="p">)</span>

    <span class="n">n_index</span> <span class="o">=</span> <span class="n">index</span>

    <span class="k">if</span> <span class="n">index</span><span class="o">.</span><span class="n">bit_length</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">63</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">OverflowError</span><span class="p">):</span>
            <span class="n">bdb</span><span class="o">.</span><span class="n">delete_rec</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">delay_commit</span><span class="o">=</span><span class="n">delay_commit</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">with</span> <span class="n">mock</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s1">&#39;builtins.input&#39;</span><span class="p">,</span> <span class="n">return_value</span><span class="o">=</span><span class="n">input_retval</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">bdb</span><span class="o">.</span><span class="n">delete_rec</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">delay_commit</span><span class="o">=</span><span class="n">delay_commit</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">n_index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="n">res</span>
    <span class="k">elif</span> <span class="n">n_index</span> <span class="o">&gt;</span> <span class="n">db_len</span><span class="p">:</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="n">res</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">bdb</span><span class="o">.</span><span class="n">get_rec_all</span><span class="p">())</span> <span class="o">==</span> <span class="n">db_len</span>
    <span class="k">elif</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">input_retval</span> <span class="o">!=</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="n">res</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">bdb</span><span class="o">.</span><span class="n">get_rec_all</span><span class="p">())</span> <span class="o">==</span> <span class="n">db_len</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">res</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">bdb</span><span class="o">.</span><span class="n">get_rec_all</span><span class="p">())</span> <span class="o">==</span> <span class="n">db_len</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">delay_commit</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">bdb_dc</span><span class="o">.</span><span class="n">get_rec_all</span><span class="p">())</span> <span class="o">==</span> <span class="n">db_len</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">bdb_dc</span><span class="o">.</span><span class="n">get_rec_all</span><span class="p">())</span> <span class="o">==</span> <span class="n">db_len</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="c1"># teardown</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;XDG_DATA_HOME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">TEST_TEMP_DIR_PATH</span></div>


<div class="viewcode-block" id="test_delete_rec_on_empty_database"><a class="viewcode-back" href="../../source/tests.html#tests.test_bukuDb.test_delete_rec_on_empty_database">[docs]</a><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span>
    <span class="s1">&#39;index, is_range, low, high&#39;</span><span class="p">,</span>
    <span class="p">[</span>
        <span class="c1"># range on non zero index</span>
        <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="c1"># range on zero index</span>
        <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="c1"># zero index only</span>
        <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="p">]</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">test_delete_rec_on_empty_database</span><span class="p">(</span><span class="n">setup</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">is_range</span><span class="p">,</span> <span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;test delete rec, on empty database.&quot;&quot;&quot;</span>
    <span class="n">bdb</span> <span class="o">=</span> <span class="n">BukuDb</span><span class="p">()</span>
    <span class="k">with</span> <span class="n">mock</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s1">&#39;builtins.input&#39;</span><span class="p">,</span> <span class="n">return_value</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">bdb</span><span class="o">.</span><span class="n">delete_rec</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">is_range</span><span class="p">,</span> <span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">is_range</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">([</span><span class="n">low</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">high</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]))</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="n">is_range</span> <span class="ow">and</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">res</span>
        <span class="c1"># teardown</span>
        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;XDG_DATA_HOME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">TEST_TEMP_DIR_PATH</span>
        <span class="k">return</span>

    <span class="k">if</span> <span class="n">is_range</span> <span class="ow">and</span> <span class="n">low</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">high</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="n">res</span>

    <span class="c1"># teardown</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;XDG_DATA_HOME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">TEST_TEMP_DIR_PATH</span></div>


<div class="viewcode-block" id="test_delete_rec_on_non_interger"><a class="viewcode-back" href="../../source/tests.html#tests.test_bukuDb.test_delete_rec_on_non_interger">[docs]</a><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span>
    <span class="s1">&#39;index, low, high, is_range&#39;</span><span class="p">,</span>
    <span class="p">[</span>
        <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">True</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">False</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">],</span>
    <span class="p">]</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">test_delete_rec_on_non_interger</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">,</span> <span class="n">is_range</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;test delete rec on non integer arg.&quot;&quot;&quot;</span>
    <span class="n">bdb</span> <span class="o">=</span> <span class="n">BukuDb</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">bookmark</span> <span class="ow">in</span> <span class="n">TEST_BOOKMARKS</span><span class="p">:</span>
        <span class="n">bdb</span><span class="o">.</span><span class="n">add_rec</span><span class="p">(</span><span class="o">*</span><span class="n">bookmark</span><span class="p">)</span>
    <span class="n">db_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">TEST_BOOKMARKS</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">is_range</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">high</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
            <span class="n">bdb</span><span class="o">.</span><span class="n">delete_rec</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">low</span><span class="o">=</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="n">high</span><span class="p">,</span> <span class="n">is_range</span><span class="o">=</span><span class="n">is_range</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="n">is_range</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">bdb</span><span class="o">.</span><span class="n">delete_rec</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">low</span><span class="o">=</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="n">high</span><span class="p">,</span> <span class="n">is_range</span><span class="o">=</span><span class="n">is_range</span><span class="p">)</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="n">res</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">bdb</span><span class="o">.</span><span class="n">get_rec_all</span><span class="p">())</span> <span class="o">==</span> <span class="n">db_len</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">bdb</span><span class="o">.</span><span class="n">delete_rec</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">low</span><span class="o">=</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="n">high</span><span class="p">,</span> <span class="n">is_range</span><span class="o">=</span><span class="n">is_range</span><span class="p">)</span></div>


<div class="viewcode-block" id="test_add_rec_add_invalid_url"><a class="viewcode-back" href="../../source/tests.html#tests.test_bukuDb.test_add_rec_add_invalid_url">[docs]</a><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s1">&#39;url&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">test_add_rec_add_invalid_url</span><span class="p">(</span><span class="n">caplog</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;test method.&quot;&quot;&quot;</span>
    <span class="n">bdb</span> <span class="o">=</span> <span class="n">BukuDb</span><span class="p">()</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">bdb</span><span class="o">.</span><span class="n">add_rec</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">res</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">caplog</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">levelname</span> <span class="o">==</span> <span class="s1">&#39;ERROR&#39;</span>
    <span class="n">caplog</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getMessage</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;Invalid URL&#39;</span></div>


<div class="viewcode-block" id="test_add_rec_exec_arg"><a class="viewcode-back" href="../../source/tests.html#tests.test_bukuDb.test_add_rec_exec_arg">[docs]</a><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span>
    <span class="s2">&quot;kwargs, exp_arg&quot;</span><span class="p">,</span>
    <span class="p">[</span>
        <span class="p">[</span>
            <span class="p">{</span><span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="s1">&#39;example.com&#39;</span><span class="p">},</span>
            <span class="p">(</span><span class="s1">&#39;example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;Example Domain&#39;</span><span class="p">,</span> <span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">],</span>
        <span class="p">[</span>
            <span class="p">{</span><span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="s1">&#39;http://example.com&#39;</span><span class="p">},</span>
            <span class="p">(</span><span class="s1">&#39;http://example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;Example Domain&#39;</span><span class="p">,</span> <span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">],</span>
        <span class="p">[</span>
            <span class="p">{</span><span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="s1">&#39;http://example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;immutable&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
            <span class="p">(</span><span class="s1">&#39;http://example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;Example Domain&#39;</span><span class="p">,</span> <span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">],</span>
        <span class="p">[</span>
            <span class="p">{</span><span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="s1">&#39;http://example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;desc&#39;</span><span class="p">:</span> <span class="s1">&#39;randomdesc&#39;</span><span class="p">},</span>
            <span class="p">(</span><span class="s1">&#39;http://example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;Example Domain&#39;</span><span class="p">,</span> <span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;randomdesc&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">],</span>
        <span class="p">[</span>
            <span class="p">{</span><span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="s1">&#39;http://example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;title_in&#39;</span><span class="p">:</span> <span class="s1">&#39;randomtitle&#39;</span><span class="p">},</span>
            <span class="p">(</span><span class="s1">&#39;http://example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;randomtitle&#39;</span><span class="p">,</span> <span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">],</span>
        <span class="p">[</span>
            <span class="p">{</span><span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="s1">&#39;http://example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;tags_in&#39;</span><span class="p">:</span> <span class="s1">&#39;tag1&#39;</span><span class="p">},</span>
            <span class="p">(</span><span class="s1">&#39;http://example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;Example Domain&#39;</span><span class="p">,</span> <span class="s1">&#39;,tag1&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="p">],</span>
        <span class="p">[</span>
            <span class="p">{</span><span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="s1">&#39;http://example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;tags_in&#39;</span><span class="p">:</span> <span class="s1">&#39;,tag1&#39;</span><span class="p">},</span>
            <span class="p">(</span><span class="s1">&#39;http://example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;Example Domain&#39;</span><span class="p">,</span> <span class="s1">&#39;,tag1,&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="p">],</span>
        <span class="p">[</span>
            <span class="p">{</span><span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="s1">&#39;http://example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;tags_in&#39;</span><span class="p">:</span> <span class="s1">&#39;,tag1,&#39;</span><span class="p">},</span>
            <span class="p">(</span><span class="s1">&#39;http://example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;Example Domain&#39;</span><span class="p">,</span> <span class="s1">&#39;,tag1,&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="p">],</span>
    <span class="p">]</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">test_add_rec_exec_arg</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">exp_arg</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;test func.&quot;&quot;&quot;</span>
    <span class="n">bdb</span> <span class="o">=</span> <span class="n">BukuDb</span><span class="p">()</span>
    <span class="n">bdb</span><span class="o">.</span><span class="n">cur</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>
    <span class="n">bdb</span><span class="o">.</span><span class="n">get_rec_id</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">(</span><span class="n">return_value</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">bdb</span><span class="o">.</span><span class="n">add_rec</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">bdb</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="o">.</span><span class="n">call_args</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">exp_arg</span></div>


<div class="viewcode-block" id="test_update_rec_index_0"><a class="viewcode-back" href="../../source/tests.html#tests.test_bukuDb.test_update_rec_index_0">[docs]</a><span class="k">def</span> <span class="nf">test_update_rec_index_0</span><span class="p">(</span><span class="n">caplog</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;test method.&quot;&quot;&quot;</span>
    <span class="n">bdb</span> <span class="o">=</span> <span class="n">BukuDb</span><span class="p">()</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">bdb</span><span class="o">.</span><span class="n">update_rec</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="s1">&#39;http://example.com&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">res</span>
    <span class="k">assert</span> <span class="n">caplog</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getMessage</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;All URLs cannot be same&#39;</span>
    <span class="k">assert</span> <span class="n">caplog</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">levelname</span> <span class="o">==</span> <span class="s1">&#39;ERROR&#39;</span></div>


<div class="viewcode-block" id="test_update_rec_exec_arg"><a class="viewcode-back" href="../../source/tests.html#tests.test_bukuDb.test_update_rec_exec_arg">[docs]</a><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span>
    <span class="s1">&#39;kwargs, exp_query, exp_arguments&#39;</span><span class="p">,</span>
    <span class="p">[</span>
        <span class="p">[</span>
            <span class="p">{</span><span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="s1">&#39;http://example.com&#39;</span><span class="p">},</span>
            <span class="s1">&#39;UPDATE bookmarks SET URL = ?, metadata = ? WHERE id = ?&#39;</span><span class="p">,</span>
            <span class="p">[</span><span class="s1">&#39;http://example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;Example Domain&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

        <span class="p">],</span>
        <span class="p">[</span>
            <span class="p">{</span><span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="s1">&#39;http://example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;title_in&#39;</span><span class="p">:</span> <span class="s1">&#39;randomtitle&#39;</span><span class="p">},</span>
            <span class="s1">&#39;UPDATE bookmarks SET URL = ?, metadata = ? WHERE id = ?&#39;</span><span class="p">,</span>
            <span class="p">[</span><span class="s1">&#39;http://example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;randomtitle&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

        <span class="p">],</span>
        <span class="p">[</span>
            <span class="p">{</span><span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="s1">&#39;http://example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;tags_in&#39;</span><span class="p">:</span> <span class="s1">&#39;tag1&#39;</span><span class="p">},</span>
            <span class="s1">&#39;UPDATE bookmarks SET URL = ?, tags = ?, metadata = ? WHERE id = ?&#39;</span><span class="p">,</span>
            <span class="p">[</span><span class="s1">&#39;http://example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;,tag1&#39;</span><span class="p">,</span> <span class="s1">&#39;Example Domain&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

        <span class="p">],</span>
        <span class="p">[</span>
            <span class="p">{</span><span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="s1">&#39;http://example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;tags_in&#39;</span><span class="p">:</span> <span class="s1">&#39;+,tag1&#39;</span><span class="p">},</span>
            <span class="s1">&#39;UPDATE bookmarks SET URL = ?, metadata = ? WHERE id = ?&#39;</span><span class="p">,</span>
            <span class="p">[</span><span class="s1">&#39;http://example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;Example Domain&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

        <span class="p">],</span>
        <span class="p">[</span>
            <span class="p">{</span><span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="s1">&#39;http://example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;tags_in&#39;</span><span class="p">:</span> <span class="s1">&#39;-,tag1&#39;</span><span class="p">},</span>
            <span class="s1">&#39;UPDATE bookmarks SET URL = ?, metadata = ? WHERE id = ?&#39;</span><span class="p">,</span>
            <span class="p">[</span><span class="s1">&#39;http://example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;Example Domain&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

        <span class="p">],</span>
        <span class="p">[</span>
            <span class="p">{</span><span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="s1">&#39;http://example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;desc&#39;</span><span class="p">:</span> <span class="s1">&#39;randomdesc&#39;</span><span class="p">},</span>
            <span class="s1">&#39;UPDATE bookmarks SET URL = ?, desc = ?, metadata = ? WHERE id = ?&#39;</span><span class="p">,</span>
            <span class="p">[</span><span class="s1">&#39;http://example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;randomdesc&#39;</span><span class="p">,</span> <span class="s1">&#39;Example Domain&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

        <span class="p">],</span>
    <span class="p">]</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">test_update_rec_exec_arg</span><span class="p">(</span><span class="n">caplog</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">exp_query</span><span class="p">,</span> <span class="n">exp_arguments</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;test method.&quot;&quot;&quot;</span>
    <span class="n">bdb</span> <span class="o">=</span> <span class="n">BukuDb</span><span class="p">()</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">bdb</span><span class="o">.</span><span class="n">update_rec</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">res</span>
    <span class="n">exp_log</span> <span class="o">=</span> <span class="s1">&#39;query: &quot;</span><span class="si">{}</span><span class="s1">&quot;, args: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">exp_query</span><span class="p">,</span> <span class="n">exp_arguments</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">caplog</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">getMessage</span><span class="p">()</span> <span class="o">==</span> <span class="n">exp_log</span>
    <span class="k">assert</span> <span class="n">caplog</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">levelname</span> <span class="o">==</span> <span class="s1">&#39;DEBUG&#39;</span></div>


<div class="viewcode-block" id="test_search_by_tag_query"><a class="viewcode-back" href="../../source/tests.html#tests.test_bukuDb.test_search_by_tag_query">[docs]</a><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span>
    <span class="s1">&#39;tags_to_search, exp_query, exp_arguments&#39;</span><span class="p">,</span>
    <span class="p">[</span>
        <span class="p">[</span>
            <span class="s1">&#39;tag1, tag2&#39;</span><span class="p">,</span>
            <span class="s2">&quot;SELECT id, url, metadata, tags, desc FROM bookmarks WHERE tags LIKE &#39;%&#39; || ? || &#39;%&#39; &quot;</span>
            <span class="s2">&quot;OR tags LIKE &#39;%&#39; || ? || &#39;%&#39; ORDER BY id ASC&quot;</span><span class="p">,</span>
            <span class="p">[</span><span class="s1">&#39;,tag1,&#39;</span><span class="p">,</span> <span class="s1">&#39;,tag2,&#39;</span><span class="p">]</span>

        <span class="p">],</span>
        <span class="p">[</span>
            <span class="s1">&#39;tag1+tag2,tag3, tag4&#39;</span><span class="p">,</span>
            <span class="s2">&quot;SELECT id, url, metadata, tags, desc FROM bookmarks WHERE tags LIKE &#39;%&#39; || ? || &#39;%&#39; &quot;</span>
            <span class="s2">&quot;OR tags LIKE &#39;%&#39; || ? || &#39;%&#39; OR tags LIKE &#39;%&#39; || ? || &#39;%&#39; ORDER BY id ASC&quot;</span><span class="p">,</span>
            <span class="p">[</span><span class="s1">&#39;,tag1+tag2,&#39;</span><span class="p">,</span> <span class="s1">&#39;,tag3,&#39;</span><span class="p">,</span> <span class="s1">&#39;,tag4,&#39;</span><span class="p">]</span>
        <span class="p">],</span>
        <span class="p">[</span>
            <span class="s1">&#39;tag1 + tag2+tag3&#39;</span><span class="p">,</span>
            <span class="s2">&quot;SELECT id, url, metadata, tags, desc FROM bookmarks WHERE tags LIKE &#39;%&#39; || ? || &#39;%&#39; &quot;</span>
            <span class="s2">&quot;AND tags LIKE &#39;%&#39; || ? || &#39;%&#39; ORDER BY id ASC&quot;</span><span class="p">,</span>
            <span class="p">[</span><span class="s1">&#39;,tag1,&#39;</span><span class="p">,</span> <span class="s1">&#39;,tag2+tag3,&#39;</span><span class="p">]</span>
        <span class="p">],</span>
        <span class="p">[</span>
            <span class="s1">&#39;tag1-tag2 + tag 3 - tag4&#39;</span><span class="p">,</span>
            <span class="s2">&quot;SELECT id, url, metadata, tags, desc FROM bookmarks WHERE (tags LIKE &#39;%&#39; || ? || &#39;%&#39; &quot;</span>
            <span class="s2">&quot;AND tags LIKE &#39;%&#39; || ? || &#39;%&#39; ) AND tags NOT REGEXP ? ORDER BY id ASC&quot;</span><span class="p">,</span>
            <span class="p">[</span><span class="s1">&#39;,tag1-tag2,&#39;</span><span class="p">,</span> <span class="s1">&#39;,tag 3,&#39;</span><span class="p">,</span> <span class="s1">&#39;,tag4,&#39;</span><span class="p">]</span>
        <span class="p">]</span>
    <span class="p">]</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">test_search_by_tag_query</span><span class="p">(</span><span class="n">caplog</span><span class="p">,</span> <span class="n">tags_to_search</span><span class="p">,</span> <span class="n">exp_query</span><span class="p">,</span> <span class="n">exp_arguments</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;test that the correct query and argments are constructed&quot;&quot;&quot;</span>
    <span class="n">bdb</span> <span class="o">=</span> <span class="n">BukuDb</span><span class="p">()</span>
    <span class="n">bdb</span><span class="o">.</span><span class="n">search_by_tag</span><span class="p">(</span><span class="n">tags_to_search</span><span class="p">)</span>
    <span class="n">exp_log</span> <span class="o">=</span> <span class="s1">&#39;query: &quot;</span><span class="si">{}</span><span class="s1">&quot;, args: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">exp_query</span><span class="p">,</span> <span class="n">exp_arguments</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">caplog</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">getMessage</span><span class="p">()</span> <span class="o">==</span> <span class="n">exp_log</span>
    <span class="k">assert</span> <span class="n">caplog</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">levelname</span> <span class="o">==</span> <span class="s1">&#39;DEBUG&#39;</span></div>


<div class="viewcode-block" id="test_update_rec_only_index"><a class="viewcode-back" href="../../source/tests.html#tests.test_bukuDb.test_update_rec_only_index">[docs]</a><span class="k">def</span> <span class="nf">test_update_rec_only_index</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;test method.&quot;&quot;&quot;</span>
    <span class="n">bdb</span> <span class="o">=</span> <span class="n">BukuDb</span><span class="p">()</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">bdb</span><span class="o">.</span><span class="n">update_rec</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">res</span></div>


<div class="viewcode-block" id="test_update_rec_invalid_url"><a class="viewcode-back" href="../../source/tests.html#tests.test_bukuDb.test_update_rec_invalid_url">[docs]</a><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s1">&#39;url&#39;</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">test_update_rec_invalid_url</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;test method.&quot;&quot;&quot;</span>
    <span class="n">bdb</span> <span class="o">=</span> <span class="n">BukuDb</span><span class="p">()</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">bdb</span><span class="o">.</span><span class="n">update_rec</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">res</span></div>


<div class="viewcode-block" id="test_update_rec_invalid_tag"><a class="viewcode-back" href="../../source/tests.html#tests.test_bukuDb.test_update_rec_invalid_tag">[docs]</a><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s1">&#39;invalid_tag&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;+,&#39;</span><span class="p">,</span> <span class="s1">&#39;-,&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">test_update_rec_invalid_tag</span><span class="p">(</span><span class="n">caplog</span><span class="p">,</span> <span class="n">invalid_tag</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;test method.&quot;&quot;&quot;</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://example.com&#39;</span>
    <span class="n">bdb</span> <span class="o">=</span> <span class="n">BukuDb</span><span class="p">()</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">bdb</span><span class="o">.</span><span class="n">update_rec</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">tags_in</span><span class="o">=</span><span class="n">invalid_tag</span><span class="p">)</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">res</span>
    <span class="k">assert</span> <span class="n">caplog</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getMessage</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;Please specify a tag&#39;</span>
    <span class="k">assert</span> <span class="n">caplog</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">levelname</span> <span class="o">==</span> <span class="s1">&#39;ERROR&#39;</span></div>


<div class="viewcode-block" id="test_update_rec_update_all_bookmark"><a class="viewcode-back" href="../../source/tests.html#tests.test_bukuDb.test_update_rec_update_all_bookmark">[docs]</a><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s1">&#39;read_in_retval&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">test_update_rec_update_all_bookmark</span><span class="p">(</span><span class="n">caplog</span><span class="p">,</span> <span class="n">read_in_retval</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;test method.&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">mock</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s1">&#39;buku.read_in&#39;</span><span class="p">,</span> <span class="n">return_value</span><span class="o">=</span><span class="n">read_in_retval</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">buku</span>
        <span class="n">bdb</span> <span class="o">=</span> <span class="n">buku</span><span class="o">.</span><span class="n">BukuDb</span><span class="p">()</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">bdb</span><span class="o">.</span><span class="n">update_rec</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">tags_in</span><span class="o">=</span><span class="s1">&#39;tags1&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">read_in_retval</span> <span class="o">!=</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
            <span class="k">assert</span> <span class="ow">not</span> <span class="n">res</span>
            <span class="k">return</span>
        <span class="k">assert</span> <span class="n">res</span>
        <span class="k">assert</span> <span class="n">caplog</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getMessage</span><span class="p">()</span> <span class="o">==</span> \
            <span class="s1">&#39;query: &quot;UPDATE bookmarks SET tags = ?&quot;, args: [</span><span class="se">\&#39;</span><span class="s1">,tags1</span><span class="se">\&#39;</span><span class="s1">]&#39;</span>
        <span class="k">assert</span> <span class="n">caplog</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">levelname</span> <span class="o">==</span> <span class="s1">&#39;DEBUG&#39;</span></div>


<div class="viewcode-block" id="test_edit_update_rec_with_invalid_input"><a class="viewcode-back" href="../../source/tests.html#tests.test_bukuDb.test_edit_update_rec_with_invalid_input">[docs]</a><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span>
    <span class="s1">&#39;get_system_editor_retval, index, exp_res&#39;</span><span class="p">,</span>
    <span class="p">[</span>
        <span class="p">[</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">False</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;nano&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="kc">False</span><span class="p">],</span>
    <span class="p">]</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">test_edit_update_rec_with_invalid_input</span><span class="p">(</span><span class="n">get_system_editor_retval</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">exp_res</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;test method.&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">mock</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s1">&#39;buku.get_system_editor&#39;</span><span class="p">,</span> <span class="n">return_value</span><span class="o">=</span><span class="n">get_system_editor_retval</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">buku</span>
        <span class="n">bdb</span> <span class="o">=</span> <span class="n">buku</span><span class="o">.</span><span class="n">BukuDb</span><span class="p">()</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">bdb</span><span class="o">.</span><span class="n">edit_update_rec</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">res</span> <span class="o">==</span> <span class="n">exp_res</span></div>


<div class="viewcode-block" id="test_browse_by_index"><a class="viewcode-back" href="../../source/tests.html#tests.test_bukuDb.test_browse_by_index">[docs]</a><span class="nd">@given</span><span class="p">(</span>
    <span class="n">low</span><span class="o">=</span><span class="n">st</span><span class="o">.</span><span class="n">integers</span><span class="p">(</span><span class="n">min_value</span><span class="o">=-</span><span class="mi">2</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
    <span class="n">high</span><span class="o">=</span><span class="n">st</span><span class="o">.</span><span class="n">integers</span><span class="p">(</span><span class="n">min_value</span><span class="o">=-</span><span class="mi">2</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
    <span class="n">index</span><span class="o">=</span><span class="n">st</span><span class="o">.</span><span class="n">integers</span><span class="p">(</span><span class="n">min_value</span><span class="o">=-</span><span class="mi">2</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
    <span class="n">is_range</span><span class="o">=</span><span class="n">st</span><span class="o">.</span><span class="n">booleans</span><span class="p">(),</span>
    <span class="n">empty_database</span><span class="o">=</span><span class="n">st</span><span class="o">.</span><span class="n">booleans</span><span class="p">(),</span>
<span class="p">)</span>
<span class="nd">@example</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">is_range</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">empty_database</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_browse_by_index</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">is_range</span><span class="p">,</span> <span class="n">empty_database</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;test method.&quot;&quot;&quot;</span>
    <span class="n">n_low</span><span class="p">,</span> <span class="n">n_high</span> <span class="o">=</span> <span class="p">(</span><span class="n">high</span><span class="p">,</span> <span class="n">low</span><span class="p">)</span> <span class="k">if</span> <span class="n">low</span> <span class="o">&gt;</span> <span class="n">high</span> <span class="k">else</span> <span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">mock</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s1">&#39;buku.browse&#39;</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">buku</span>
        <span class="n">bdb</span> <span class="o">=</span> <span class="n">buku</span><span class="o">.</span><span class="n">BukuDb</span><span class="p">()</span>
        <span class="n">bdb</span><span class="o">.</span><span class="n">delete_rec_all</span><span class="p">()</span>
        <span class="n">db_len</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">empty_database</span><span class="p">:</span>
            <span class="n">bdb</span><span class="o">.</span><span class="n">add_rec</span><span class="p">(</span><span class="s2">&quot;https://www.google.com/ncr&quot;</span><span class="p">,</span> <span class="s2">&quot;?&quot;</span><span class="p">)</span>
            <span class="n">db_len</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">bdb</span><span class="o">.</span><span class="n">browse_by_index</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">low</span><span class="o">=</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="n">high</span><span class="p">,</span> <span class="n">is_range</span><span class="o">=</span><span class="n">is_range</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">is_range</span> <span class="ow">and</span> <span class="p">(</span><span class="n">low</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">high</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">assert</span> <span class="ow">not</span> <span class="n">res</span>
        <span class="k">elif</span> <span class="n">is_range</span> <span class="ow">and</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">n_low</span> <span class="ow">and</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">n_high</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">res</span>
        <span class="k">elif</span> <span class="n">is_range</span><span class="p">:</span>
            <span class="k">assert</span> <span class="ow">not</span> <span class="n">res</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">is_range</span> <span class="ow">and</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">assert</span> <span class="ow">not</span> <span class="n">res</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">is_range</span> <span class="ow">and</span> <span class="n">index</span> <span class="o">&gt;</span> <span class="n">db_len</span><span class="p">:</span>
            <span class="k">assert</span> <span class="ow">not</span> <span class="n">res</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">is_range</span> <span class="ow">and</span> <span class="n">index</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">empty_database</span><span class="p">:</span>
            <span class="k">assert</span> <span class="ow">not</span> <span class="n">res</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">is_range</span> <span class="ow">and</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">index</span> <span class="o">&lt;=</span> <span class="n">db_len</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">empty_database</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">res</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span>
        <span class="n">bdb</span><span class="o">.</span><span class="n">delete_rec_all</span><span class="p">()</span></div>

<span class="c1"># Helper functions for testcases</span>


<div class="viewcode-block" id="split_and_test_membership"><a class="viewcode-back" href="../../source/tests.html#tests.test_bukuDb.split_and_test_membership">[docs]</a><span class="k">def</span> <span class="nf">split_and_test_membership</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="c1"># :param a, b: comma separated strings to split</span>
    <span class="c1"># test everything in a in b</span>
    <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="n">x</span> <span class="ow">in</span> <span class="n">b</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">))</span></div>


<div class="viewcode-block" id="inclusive_range"><a class="viewcode-back" href="../../source/tests.html#tests.test_bukuDb.inclusive_range">[docs]</a><span class="k">def</span> <span class="nf">inclusive_range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span></div>


<div class="viewcode-block" id="normalize_range"><a class="viewcode-back" href="../../source/tests.html#tests.test_bukuDb.normalize_range">[docs]</a><span class="k">def</span> <span class="nf">normalize_range</span><span class="p">(</span><span class="n">db_len</span><span class="p">,</span> <span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;normalize index and range.</span>

<span class="sd">    Args:</span>
<span class="sd">        db_len (int): database length.</span>
<span class="sd">        low (int): low limit.</span>
<span class="sd">        high (int): high limit.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple contain following normalized variables (low, high)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">require_comparison</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="c1"># don&#39;t deal with non instance of the variable.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">n_low</span> <span class="o">=</span> <span class="n">low</span>
        <span class="n">require_comparison</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">high</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">n_high</span> <span class="o">=</span> <span class="n">high</span>
        <span class="n">require_comparison</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="n">max_value</span> <span class="o">=</span> <span class="n">db_len</span>
    <span class="k">if</span> <span class="n">low</span> <span class="o">==</span> <span class="s1">&#39;max&#39;</span> <span class="ow">and</span> <span class="n">high</span> <span class="o">==</span> <span class="s1">&#39;max&#39;</span><span class="p">:</span>
        <span class="n">n_low</span> <span class="o">=</span> <span class="n">db_len</span>
        <span class="n">n_high</span> <span class="o">=</span> <span class="n">max_value</span>
    <span class="k">elif</span> <span class="n">low</span> <span class="o">==</span> <span class="s1">&#39;max&#39;</span> <span class="ow">and</span> <span class="n">high</span> <span class="o">!=</span> <span class="s1">&#39;max&#39;</span><span class="p">:</span>
        <span class="n">n_low</span> <span class="o">=</span> <span class="n">high</span>
        <span class="n">n_high</span> <span class="o">=</span> <span class="n">max_value</span>
    <span class="k">elif</span> <span class="n">low</span> <span class="o">!=</span> <span class="s1">&#39;max&#39;</span> <span class="ow">and</span> <span class="n">high</span> <span class="o">==</span> <span class="s1">&#39;max&#39;</span><span class="p">:</span>
        <span class="n">n_low</span> <span class="o">=</span> <span class="n">low</span>
        <span class="n">n_high</span> <span class="o">=</span> <span class="n">max_value</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">n_low</span> <span class="o">=</span> <span class="n">low</span>
        <span class="n">n_high</span> <span class="o">=</span> <span class="n">high</span>

    <span class="k">if</span> <span class="n">require_comparison</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">n_high</span> <span class="o">&lt;</span> <span class="n">n_low</span><span class="p">:</span>
            <span class="n">n_high</span><span class="p">,</span> <span class="n">n_low</span> <span class="o">=</span> <span class="n">n_low</span><span class="p">,</span> <span class="n">n_high</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">n_low</span><span class="p">,</span> <span class="n">n_high</span><span class="p">)</span></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>

           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Arun Prakash Jana.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>